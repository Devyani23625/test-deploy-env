name: Release Pipeline

on:
  workflow_dispatch:

jobs:
  release:
    runs-on: ubuntu-latest
    outputs:
      result: ${{ job.status }}
    steps:
      - run: |
          echo "Simulating build..."
          # Uncomment this to simulate failure:
           exit 1

  trigger-deploy:
    needs: release
    if: always()  # Ensures this runs even if release failed
    uses: ./.github/workflows/deploy.yml
    with:
      rollback: ${{ needs.release.result == 'failure' }}
